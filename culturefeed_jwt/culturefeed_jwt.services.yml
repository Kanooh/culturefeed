services:

  culturefeed_jwt.authentication_provider:
    class: CultuurNet\SymfonySecurityJwt\Authentication\JwtAuthenticationProvider
    arguments: ['@culturefeed_jwt.decoder_service']
  culturefeed_jwt.decoder_service:
    class: CultuurNet\UDB3\Jwt\JwtDecoderService
    factory: culturefeed_jwt.decoder_service.factory:get
  culturefeed_jwt.decoder_service.factory:
    class: Drupal\culturefeed_jwt\Factory\JwtDecoderServiceFactory
    arguments: ['@culturefeed_jwt.validation_data', '@culturefeed_jwt.public_key']
  culturefeed_jwt.public_key:
    class: Lcobucci\JWT\Signer\Key
    factory: culturefeed_jwt.public_key.factory:get
  culturefeed_jwt.public_key.factory:
    class: Drupal\culturefeed_jwt\Factory\JwtPublicKeyFactory
    arguments: ['@config.factory']
  culturefeed_jwt.token:
    class: CultuurNet\SymfonySecurityJwt\Authentication\JwtUserToken
    factory: culturefeed_jwt.token.factory:get
  culturefeed_jwt.token.factory:
    class: Drupal\culturefeed_jwt\Factory\JwtTokenFactory
    arguments: ['@entity.query', '@current_user']
  culturefeed_jwt.validation_data:
    class: Lcobucci\JWT\ValidationData
    factory: culturefeed_jwt.validation_data.factory:get
  culturefeed_jwt.validation_data.factory:
    class: Drupal\culturefeed_jwt\Factory\JwtValidationDataFactory
    arguments: ['@config.factory']

  culturefeed_jwt.authentication:
    class: Drupal\culturefeed_jwt\Authentication
    arguments: ['@culturefeed_jwt.decoder_service', '@culturefeed.user_map', '@entity_type.manager', '@entity.query']
  culturefeed_jwt.subscriber:
    class: Drupal\culturefeed_jwt\Routing\RouteSubscriber
    tags:
      - { name: event_subscriber }
